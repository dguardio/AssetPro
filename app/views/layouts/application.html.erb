<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>AssetPro</title>
  
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,Roboto+Slab:400,700" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="g-sidenav-show bg-gray-200" data-controller="sidebar">
  <!-- Sidebar -->
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-gradient-dark" 
         id="sidenav-main" 
         data-sidebar-target="sidebar">

    
    <div class="sidenav-header">
      <%= link_to root_path, class: "navbar-brand m-0" do %>
        <span class="ms-2">AssetPro</span>
      <% end %>
    </div>

    <hr class="horizontal light mt-0">

    <div class="collapse navbar-collapse w-auto h-auto" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <%= link_to root_path, class: "nav-link #{current_page?(root_path) ? 'active' : ''}" do %>
            <span class="material-icons-round">dashboard</span>
            <span>Dashboard</span>
          <% end %>
        </li>

        <li class="nav-item">
          <%= link_to assets_path, class: "nav-link #{current_page?(assets_path) ? 'active' : ''}" do %>
            <span class="material-icons-round">inventory_2</span>
            <span>Assets</span>
          <% end %>
        </li>

        <% if current_user&.security? || current_user&.admin? %>
          <li class="nav-item">
            <%= link_to scanner_path, class: "nav-link #{current_page?(scanner_path) ? 'active' : ''}" do %>
              <span class="material-icons-round">qr_code_scanner</span>
              <span>Scanner</span>
            <% end %>
          </li>
        <% end %>

        <% if current_user&.admin? %>
          <li class="nav-item-header">
            Admin
          </li>

          <li class="nav-item">
            <%= link_to categories_path, class: "nav-link #{current_page?(categories_path) ? 'active' : ''}" do %>
              <span class="material-icons-round">category</span>
              <span>Categories</span>
            <% end %>
          </li>

          <li class="nav-item">
            <%= link_to locations_path, class: "nav-link #{current_page?(locations_path) ? 'active' : ''}" do %>
              <span class="material-icons-round">place</span>
              <span>Locations</span>
            <% end %>
          </li>

          <li class="nav-item">
            <%= link_to admin_users_path, class: "nav-link #{current_page?(admin_users_path) ? 'active' : ''}" do %>
              <span class="material-icons-round">people</span>
              <span>Manage Users</span>
            <% end %>
          </li>
        <% end %>

        <li class="nav-item-header">
          Account
        </li>

        <% if user_signed_in? %>
          <li class="nav-item">
            <%= link_to edit_user_registration_path, class: "nav-link #{current_page?(edit_user_registration_path) ? 'active' : ''}" do %>
              <span class="material-icons-round">person</span>
              <span>Profile</span>
            <% end %>
          </li>

          <li class="nav-item">
            <%= button_to destroy_user_session_path, method: :delete, class: "nav-link" do %>
              <span class="material-icons-round">logout</span>
              <span>Logout</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  </aside>

  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg" 
        data-sidebar-target="content">
    <!-- Navbar with animated hamburger -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur">
      <div class="container-fluid py-1 px-3">
        <!-- Animated hamburger button -->
        <button class="hamburger-button" data-action="click->sidebar#toggle" data-sidebar-target="button">
          <span class="line"></span>
          <span class="line"></span>
          <span class="line"></span>
        </button>

        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <div class="ms-md-auto pe-md-3 d-flex align-items-center">
            <% if user_signed_in? %>
              <span class="nav-link text-body font-weight-bold px-0">
                <%= current_user.email %> (<%= current_user.role %>)
              </span>
            <% end %>
          </div>
        </div>
      </div>
    </nav>

    <!-- Content -->
    <div class="container-fluid py-4">
      <% if notice %>
        <div class="alert alert-success alert-dismissible text-white fade show" role="alert">
          <span class="alert-text"><%= notice %></span>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      <% end %>

      <% if alert %>
        <div class="alert alert-danger alert-dismissible text-white fade show" role="alert">
          <span class="alert-text"><%= alert %></span>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      <% end %>

      <%= yield %>
    </div>
  </main>
</body>
</html>
